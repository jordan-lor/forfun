<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fly Birdy - Top 10</title>
<style>
  body {
    margin: 0;
    background: #87CEEB;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
  }
  canvas {
    border: 2px solid black;
    background: #87CEEB;
  }
  #leaderboard {
    margin-top: 10px;
    width: 400px;
    text-align: left;
    background: rgba(255,255,255,0.9);
    padding: 10px;
    border-radius: 5px;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="500"></canvas>
<div id="leaderboard"></div>

<script>
// ---- Prompt for username ----
let username = prompt("Enter your username:", "Player") || "Player";

// ---- Canvas Setup ----
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ---- Images ----
const playerImg = new Image();
playerImg.src = "https://www.nicepng.com/png/detail/183-1831944_flappy-bird-sprite-computer-icons-opengameart-bird-sprite.png";

const cloudImg = new Image();
cloudImg.src = "https://clipartmax.com/png/middle/51-512610_clouds-clipart-bird-sky.png";

const otherBirdImg = new Image();
otherBirdImg.src = "https://clipartmax.com/png/middle/312-3123910_flappy-bird-sprite-computer-icons-opengameart-clipart-flying-bird.png";

// ---- Player ----
const birdX = 80;
const birdRadius = 20;
let birdY = 250;
let birdVelocity = 0;
const gravity = 0.5;
const jumpStrength = -8;

// ---- Pipes ----
let pipeX = canvas.width;
let gapY = 200;
const gapHeight = 120;

// ---- Score ----
let score = 0;

// ---- Clouds ----
let clouds = [];
for(let i = 0; i < 5; i++){
  clouds.push({ x: Math.random() * canvas.width, y: Math.random() * 100 });
}

// ---- Other Birds ----
let otherBirds = [];
for(let i = 0; i < 3; i++){
  otherBirds.push({ x: Math.random() * canvas.width, y: Math.random() * 200 });
}

// ---- Controls ----
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") birdVelocity = jumpStrength;
});
document.addEventListener("touchstart", () => birdVelocity = jumpStrength);

// ---- Leaderboard ----
function getLeaderboard() {
  return JSON.parse(localStorage.getItem("leaderboard") || "[]");
}

function saveScore(username, score) {
  const leaderboard = getLeaderboard();
  leaderboard.push({ username, score });
  leaderboard.sort((a,b)=>b.score-a.score);
  if(leaderboard.length>10) leaderboard.length = 10; // keep top 10
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

function displayLeaderboard() {
  const leaderboardDiv = document.getElementById("leaderboard");
  const leaderboard = getLeaderboard();
  let html = "<strong>Top 10 Scores:</strong><br>";
  leaderboard.forEach((entry, i) => {
    html += `${i+1}. ${entry.username}: ${entry.score}<br>`;
  });
  leaderboardDiv.innerHTML = html;
}

// ---- Game Loop ----
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw clouds
  clouds.forEach(c => {
    c.x -= 0.5;
    if (c.x < -150) c.x = canvas.width;
    ctx.drawImage(cloudImg, c.x, c.y, 100, 60);
  });

  // Draw other flying birds
  otherBirds.forEach(b => {
    b.x -= 1.5;
    if (b.x < -50) b.x = canvas.width;
    ctx.drawImage(otherBirdImg, b.x, b.y, 40, 30);
  });

  // Bird physics
  birdVelocity += gravity;
  birdY += birdVelocity;

  // Draw player bird
  ctx.drawImage(playerImg, birdX - 20, birdY - 20, 40, 40);

  // Pipe movement
  pipeX -= 2;
  if (pipeX < -40) {
    pipeX = canvas.width;
    gapY = Math.random() * 250 + 50;
    score++;
  }

  // Draw pipes
  ctx.fillStyle = "green";
  ctx.fillRect(pipeX, 0, 40, gapY);
  ctx.fillRect(pipeX, gapY + gapHeight, 40, canvas.height);

  // Collision
  if (
    birdY < 0 ||
    birdY > canvas.height ||
    (birdX + birdRadius > pipeX && birdX - birdRadius < pipeX + 40 &&
     (birdY - birdRadius < gapY || birdY + birdRadius > gapY + gapHeight))
  ) {
    // Save score if >0
    if(score>0) saveScore(username, score);
    displayLeaderboard();

    // Reset game
    birdY = 250;
    birdVelocity = 0;
    pipeX = canvas.width;
    score = 0;
  }

  // Draw score
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 25);

  requestAnimationFrame(loop);
}

// Initial leaderboard display
displayLeaderboard();
loop();
</script>

</body>
</html>
